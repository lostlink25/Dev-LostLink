<!DOCTYPE HTML>
     <html>
         <head>
             <title>LostLink - Staff Portal</title>
             <meta charset="utf-8" />
             <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
             <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://accounts.google.com https://www.gstatic.com https://apis.google.com; object-src 'none'; base-uri 'self';" />
             <link rel="stylesheet" href="assets/css/main.css" />
             <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
             <style>
                 .portal-container {
                     padding: 20px;
                 }
                 .dashboard {
                     display: none;
                 }
                 .dashboard table {
                     width: 100%;
                     border-collapse: collapse;
                     margin-top: 20px;
                 }
                 .dashboard th, .dashboard td {
                     border: 1px solid #ccc;
                     padding: 10px;
                     text-align: left;
                 }
                 .dashboard th {
                     background-color: #1976D2;
                     color: white;
                     font-weight: bold;
                 }
                 .dashboard tr:nth-child(even) {
                     background-color: #f9f9f9;
                 }
                 .error {
                     color: red;
                     display: none;
                     font-size: 0.9em;
                     text-align: center;
                     margin-top: 20px;
                 }
                 .logout-button {
                     display: inline-block;
                     padding: 10px 20px;
                     background-color: #df7366;
                     color: white;
                     border: none;
                     border-radius: 4px;
                     cursor: pointer;
                     text-decoration: none;
                     font-size: 1em;
                     margin-top: 20px;
                 }
                 .logout-button:hover {
                     background-color: #ef8376;
                 }
             </style>
         </head>
         <body class="is-preload">
             <div id="page-wrapper">
                 <!-- Header -->
                 <div id="header">
                     <!-- Nav -->
                     <nav id="nav">
                         <ul>
                             <li><a href="index.html">Home</a></li>
                             <li><a href="About_Us.html">About Us</a></li>
                             <li><a href="report_Lost_Items.html">Report Lost Items</a></li>
                             <li><a href="track_your_item.html">Track Items</a></li>
                             <li><a href="claim_item.html">Claim Items</a></li>
                             <li><a href="contact_support.html">Contact Us</a></li>
                         </ul>
                     </nav>
                 </div>

                 <!-- Main -->
                 <div class="wrapper style2">
                     <article id="main" class="container special">
                         <header>
                             <h2>Staff Portal</h2>
                             <p>View reported lost and found items (Staff Only)</p>
                         </header>
                         <section class="portal-container">
                             <div class="dashboard" id="dashboard">
                                 <h3>Lost Items</h3>
                                 <table id="lostItemsTable">
                                     <thead>
                                         <tr>
                                             <th>Timestamp</th>
                                             <th>Name</th>
                                             <th>Email</th>
                                             <th>Phone</th>
                                             <th>Airport</th>
                                             <th>Item Type</th>
                                             <th>Description</th>
                                             <th>Date Lost</th>
                                             <th>Tracking ID</th>
                                         </tr>
                                     </thead>
                                     <tbody></tbody>
                                 </table>
                                 <h3>Found Items</h3>
                                 <table id="foundItemsTable">
                                     <thead>
                                         <tr>
                                             <th>Tracking ID</th>
                                             <th>Item Type</th>
                                             <th>Airport</th>
                                             <th>Description</th>
                                             <th>Found Date</th>
                                             <th>Location</th>
                                             <th>Status</th>
                                             <th>Reported By</th>
                                             <th>Reporter Type</th>
                                         </tr>
                                     </thead>
                                     <tbody></tbody>
                                 </table>
                                 <button class="logout-button" onclick="logout()">Logout</button>
                                 <p class="error" id="dataError">Failed to load items. Please try again.</p>
                             </div>
                         </section>
                     </article>
                 </div>

                 <!-- Footer -->
                 <div id="footer">
                     <div class="container">
                         <div class="row">
                             <section class="contact">
                                 <header>
                                     <h3>Have Questions?</h3>
                                 </header>
                                 <p>Our support team is here to assist you with tracking or recovering your lost items.</p>
                                 <ul class="icons">
                                     <li><a href="#" class="icon brands fa-x-twitter"><span class="label">X</span></a></li>
                                     <li><a href="https://www.facebook.com" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
                                     <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
                                     <li><a href="#" class="icon brands fa-pinterest"><span class="label">Pinterest</span></a></li>
                                     <li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
                                     <li><a href="#" class="icon brands fa-linkedin-in"><span class="label">Linkedin</span></a></li>
                                 </ul>
                             </section>
                             <div class="copyright">
                                 <ul class="menu">
                                     <li>Â© LostLink. All rights reserved.</li>
                                     <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                                 </ul>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>

             <!-- Scripts -->
             <script src="https://apis.google.com/js/api.js"></script>
             <script src="assets/js/jquery.min.js"></script>
             <script src="assets/js/jquery.dropotron.min.js"></script>
             <script src="assets/js/jquery.scrolly.min.js"></script>
             <script src="assets/js/jquery.scrollex.min.js"></script>
             <script src="assets/js/browser.min.js"></script>
             <script src="assets/js/breakpoints.min.js"></script>
             <script src="assets/js/util.js"></script>
             <script src="assets/js/main.js"></script>
             <script>
                 console.log('Script loaded at:', new Date().toISOString());
                 try {
                     console.log('Checking for jQuery');
                     if (typeof jQuery === 'undefined') {
                         console.error('jQuery not loaded');
                         alert('Error: jQuery not loaded. Please contact support.');
                         throw new Error('jQuery not loaded');
                     }
                     console.log('jQuery loaded:', jQuery.fn.jquery);

                     const LOST_SPREADSHEET_ID = '1Ua03tbd9imSPsGRjuFi7FLN0YAXW9GSKMPBrrlHd8Wc';
                     const FOUND_SPREADSHEET_ID = '1Ua03tbd9imSPsGRjuFi7FLN0YAXW9GSKMPBrrlHd8Wc';

                     function initGapiClient() {
                         return new Promise((resolve, reject) => {
                             gapi.load('client', () => {
                                 gapi.client.init({
                                     discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                                 }).then(() => {
                                     console.log('gapi client initialized');
                                     resolve();
                                 }).catch(error => {
                                     console.error('gapi client initialization error:', error);
                                     reject(error);
                                 });
                             });
                         });
                     }

                     async function loadDashboard() {
                         try {
                             const accessToken = localStorage.getItem('staffAccessToken');
                             if (!accessToken) {
                                 window.location.assign('login_staff.html');
                                 return;
                             }

                             await initGapiClient();
                             gapi.client.setToken({ access_token: accessToken });

                             console.log('Fetching lost items');
                             const lostResponse = await gapi.client.sheets.spreadsheets.values.get({
                                 spreadsheetId: LOST_SPREADSHEET_ID,
                                 range: 'LostItems!A2:I'
                             });
                             const lostItems = lostResponse.result.values || [];
                             console.log('Lost items:', lostItems);

                             console.log('Fetching found items');
                             const foundResponse = await gapi.client.sheets.spreadsheets.values.get({
                                 spreadsheetId: FOUND_SPREADSHEET_ID,
                                 range: 'FoundItems!A2:I'
                             });
                             const foundItems = foundResponse.result.values || [];
                             console.log('Found items:', foundItems);

                             $('#dashboard').show();

                             const lostTbody = $('#lostItemsTable tbody');
                             lostTbody.empty();
                             if (lostItems.length === 0) {
                                 lostTbody.append('<tr><td colspan="9">No lost items found.</td></tr>');
                             } else {
                                 lostItems.forEach(item => {
                                     const row = `
                                         <tr>
                                             <td>${item[0] || ''}</td>
                                             <td>${item[1] || ''}</td>
                                             <td>${item[2] || ''}</td>
                                             <td>${item[3] || ''}</td>
                                             <td>${item[4] || ''}</td>
                                             <td>${item[5] || ''}</td>
                                             <td>${item[6] || ''}</td>
                                             <td>${item[7] || ''}</td>
                                             <td>${item[8] || ''}</td>
                                         </tr>
                                     `;
                                     lostTbody.append(row);
                                 });
                             }

                             const foundTbody = $('#foundItemsTable tbody');
                             foundTbody.empty();
                             if (foundItems.length === 0) {
                                 foundTbody.append('<tr><td colspan="9">No found items found.</td></tr>');
                             } else {
                                 foundItems.forEach(item => {
                                     const row = `
                                         <tr>
                                             <td>${item[0] || ''}</td>
                                             <td>${item[1] || ''}</td>
                                             <td>${item[2] || ''}</td>
                                             <td>${item[3] || ''}</td>
                                             <td>${item[4] || ''}</td>
                                             <td>${item[5] || ''}</td>
                                             <td>${item[6] || ''}</td>
                                             <td>${item[7] || ''}</td>
                                             <td>${item[8] || ''}</td>
                                         </tr>
                                     `;
                                     foundTbody.append(row);
                                 });
                             }
                         } catch (error) {
                             console.error('Error loading dashboard:', error.message);
                             $('#dataError').css('display', 'block');
                             localStorage.removeItem('staffAccessToken');
                             window.location.assign('login_staff.html');
                         }
                     }

                     function logout() {
                         localStorage.removeItem('staffAccessToken');
                         window.location.assign('login_staff.html');
                     }

                     document.addEventListener('DOMContentLoaded', () => {
                         $('#dashboard').hide();
                         loadDashboard();
                     });
                 } catch (error) {
                     console.error('Script initialization error:', error.message);
                     $('#dataError').css('display', 'block');
                 }
             </script>
         </body>
     </html>