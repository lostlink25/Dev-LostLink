<!DOCTYPE HTML>
<html>
	<head>
		<title>Report Lost Item - LostLink</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
			.form-container {
				padding: 20px;
			}
			.form-container label {
				display: block;
				margin: 10px 0 5px;
				font-weight: bold;
				color: #333;
			}
			.form-container input, .form-container select, .form-container textarea {
				width: 100%;
				padding: 8px;
				margin-bottom: 15px;
				border: 1px solid #ccc;
				border-radius: 4px;
				box-sizing: border-box;
				font-size: 1em;
			}
			.form-container button {
				display: inline-block;
				padding: 10px 20px;
				background-color: #007bff;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				text-align: center;
				text-decoration: none;
			}
			.form-container button:hover {
				background-color: #0056b3;
			}
		</style>
	</head>
	<body class="Report is-preload">
		<div id="page-wrapper">

				<!-- Header -->
				<div id="header">
					<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="About_Us.html">About Us</a></li>
							<li><a href="Report_Lost_Items.html">Report Lost Items</a></li>
							<li><a href="track_your_item.html">Track Items</a></li>
							<li><a href="claim_item.html">Claim Items</a></li>
                            <li><a href="contact_support.html">Contact Us</a></li>
						</ul>
					</nav>
				</div>
			<!-- Main -->
				<div class="wrapper style1">

					<div class="container">
						<div class="row gtr-200">
							<div class="col-4 col-12-mobile" id="sidebar">
								<hr class="first" />
								<section>
									<header>
										<h3><a href="#">About LostLink</a></h3>
									</header>
									<p>
										LostLink helps you report and track items lost at US airports. We work with airport staff to make the process quick and easy.
									</p>
									<footer>
										<a href="About_Us.html" class="button">Learn More</a>
									</footer>
								</section>
								<hr />
								<section>
									<header>
										<h3><a href="#">Tips for Reporting</a></h3>
									</header>
									<p>
										Be as detailed as possible when describing your item, and report it as soon as you can to increase your chances of recovery.
									</p>
									<div class="row gtr-50">
										<div class="col-4">
											<a href="#" class="image fit"><img src="images/pic01.jpg" alt="Electronics" /></a>
										</div>
										<div class="col-8">
											<h4>Electronics</h4>
											<p>
												Include brand, color, and any unique features.
											</p>
										</div>
										<div class="col-4">
											<a href="#" class="image fit"><img src="images/pic01.jpg" alt="Luggage" /></a>
										</div>
										<div class="col-8">
											<h4>Luggage</h4>
											<p>
												Note the size, color, and any tags or stickers.
											</p>
										</div>
										<div class="col-4">
											<a href="#" class="image fit"><img src="images/pic01.jpg" alt="Clothing" /></a>
										</div>
										<div class="col-8">
											<h4>Clothing</h4>
											<p>
												Mention the type, color, and any logos.
											</p>
										</div>
										<div class="col-4">
											<a href="#" class="image fit"><img src="images/pic01.jpg" alt="Jewelry" /></a>
										</div>
										<div class="col-8">
											<h4>Jewelry</h4>
											<p>
												Describe the material, design, and any engravings.
											</p>
										</div>
										<div class="col-4">
											<a href="#" class="image fit"><img src="images/pic01.jpg" alt="Other Items" /></a>
										</div>
										<div class="col-8">
											<h4>Other Items</h4>
											<p>
												Provide as much detail as possible.
											</p>
										</div>
									</div>
									<footer>
										<a href="#" class="button">More Tips</a>
									</footer>
								</section>
							</div>
							<div class="col-8 col-12-mobile imp-mobile" id="content">
								<article id="main">
									<header>
										<h2><a href="#">Report Lost Item</a></h2>
										<p>
											Let us help you find your lost item—fill out the form below with as much detail as possible.
										</p>
									</header>
									<div class="form-container">
										<form id="lostItemForm">
										<label for="name">Your Name</label>
										<input type="text" id="name" name="name" placeholder="Enter your full name" required />
										<span class="error" id="nameError">Please enter a valid name</span>

										<label for="email">Email Address</label>
										<input type="email" id="email" name="email" placeholder="Enter your email" required />
										<span class="error" id="emailError">Please enter a valid email</span>

										<label for="phone">Phone Number</label>
										<input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required />
										<span class="error" id="phoneError">Please enter a valid phone number</span>

										<label for="airport">Airport Where Item Was Lost</label>
										<select id="airport" name="airport" required>
											<option value="" disabled selected>Select an airport</option>
											<option value="LAX">Los Angeles International (LAX)</option>
											<option value="JFK">John F. Kennedy International (JFK)</option>
											<option value="ORD">Chicago O'Hare International (ORD)</option>
											<option value="ATL">Hartsfield-Jackson Atlanta International (ATL)</option>
											<option value="DFW">Dallas/Fort Worth International (DFW)</option>
										</select>

										<label for="item-type">Item Type</label>
										<select id="item-type" name="itemType" required>
											<option value="" disabled selected>Select item type</option>
											<option value="electronics">Electronics (phone, laptop, etc.)</option>
											<option value="clothing">Clothing</option>
											<option value="luggage">Luggage</option>
											<option value="jewelry">Jewelry</option>
											<option value="other">Other</option>
										</select>

										<label for="description">Item Description</label>
										<textarea id="description" name="description" rows="4" placeholder="Describe the item (color, brand, size, etc.)" required></textarea>
										<span class="error" id="descriptionError">Please provide a description</span>

										<label for="date-lost">Date Lost</label>
										<input type="date" id="date-lost" name="dateLost" required max="2025-05-17" />
										<span class="error" id="dateLostError">Please select a valid date</span>

										<button type="submit">Submit Report</button>
									</form>
								</div>
							</article>
						</div>
					</div>
				</div>
			</div>

		<!-- Footer -->
		<div id="footer">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<!-- Contact -->
							<section class="contact">
								<header>
									<h3>Need Help with a Lost Item?</h3>
								</header>
								<p>Contact our 24/7 support team or visit our Lost and Found office at the airport.</p>
								<ul class="icons">
									<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="https://www.facebook.com" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
									<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
									<li><a href="#" class="icon brands fa-pinterest"><span class="label">Pinterest</span></a></li>
									<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
									<li><a href="#" class="icon brands fa-linkedin-in"><span class="label">Linkedin</span></a></li>
								</ul>
							</section>

						<!-- Copyright -->
							<div class="copyright">
								<ul class="menu">
									<li>© LostLink. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
								</ul>
							</div>
				<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.dropotron.min.js"></script>
<script src="assets/js/jquery.scrolly.min.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
<script>
    console.log('Script loaded at:', new Date().toISOString());
    try {
        console.log('Checking for jQuery');
        if (typeof jQuery === 'undefined') {
            console.error('jQuery not loaded');
            alert('Error: jQuery not loaded. Please contact support.');
            throw new Error('jQuery not loaded');
        }
        console.log('jQuery loaded:', jQuery.fn.jquery);

        const form = document.getElementById('lostItemForm');
        if (!form) {
            console.error('Form with ID "lostItemForm" not found');
            alert('Form not found. Please contact support.');
            throw new Error('Form not found');
        }
        console.log('Form found, attaching submit listener');

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started at:', new Date().toISOString());
            alert('Submitting form...');

            // Reset error messages
            console.log('Resetting error messages');
            try {
                document.querySelectorAll('.error').forEach(error => error.style.display = 'none');
            } catch (err) {
                console.error('Error resetting error messages:', err.message);
                alert('Error initializing form: ' + err.message);
                return;
            }

            // Get form values
            console.log('Retrieving form values');
            const name = document.getElementById('name')?.value?.trim();
            const email = document.getElementById('email')?.value?.trim();
            const phone = document.getElementById('phone')?.value?.trim();
            const airport = document.getElementById('airport')?.value;
            const itemType = document.getElementById('item-type')?.value;
            const description = document.getElementById('description')?.value?.trim();
            const dateLost = document.getElementById('date-lost')?.value;

            // Check for missing or empty values
            console.log('Checking for missing or empty values');
            if (!name || !email || !phone || !airport || !itemType || !description || !dateLost) {
                console.error('Missing or empty form values:', {
                    name: !!name, email: !!email, phone: !!phone,
                    airport: !!airport, itemType: !!itemType,
                    description: !!description, dateLost: !!dateLost
                });
                alert('Form error: All fields are required.');
                return;
            }

            // Client-side validation
            console.log('Validating form inputs');
            let isValid = true;
            const errors = [];
            if (name.length < 2) {
                document.getElementById('nameError').style.display = 'block';
                errors.push('Name must be at least 2 characters');
                isValid = false;
            }
            if (!email.match(/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
                document.getElementById('emailError').style.display = 'block';
                errors.push('Invalid email format');
                isValid = false;
            }
            if (!phone.match(/^\d{10}$|^\d{3}-\d{3}-\d{4}$/)) {
                document.getElementById('phoneError').style.display = 'block';
                errors.push('Phone must be 10 digits or XXX-XXX-XXXX');
                isValid = false;
            }
            if (description.length < 5) {
                document.getElementById('descriptionError').style.display = 'block';
                errors.push('Description must be at least 5 characters');
                isValid = false;
            }
            if (!dateLost) {
                document.getElementById('dateLostError').style.display = 'block';
                errors.push('Date lost is required');
                isValid = false;
            }

            if (!isValid) {
                console.log('Validation failed:', errors);
                alert('Please correct the following errors:\n- ' + errors.join('\n- '));
                return;
            }

            // Sanitize inputs to prevent JSON parsing issues
            console.log('Sanitizing inputs');
            const sanitizedDescription = description.replace(/[\n\r"\\]/g, ' ').trim();
            const sanitizedName = name.replace(/[\n\r"\\]/g, ' ').trim();

            const formData = {
                type: 'lostItem',
                name: sanitizedName,
                email,
                phone,
                airport,
                itemType,
                description: sanitizedDescription,
                dateLost
            };
            console.log('Sanitized form data:', formData);

            try {
                console.log('Sending fetch to Web App:', 'https://script.google.com/macros/s/AKfycbxMd697VQmuSccY7KNdoxJq78MqC3G_sa_q0AiTOe1VJ9uDSNm8_RU_1m-0x2pGvzaLsg/exec');
                const response = await fetch('https://script.google.com/macros/s/AKfycbxMd697VQmuSccY7KNdoxJq78MqC3G_sa_q0AiTOe1VJ9uDSNm8_RU_1m-0x2pGvzaLsg/exec', {
                    method: 'POST',
                    body: JSON.stringify(formData),
                    headers: { 'Content-Type': 'application/json' },
                    mode: 'cors'
                });
                console.log('Fetch response status:', response.status, 'Headers:', response.headers.get('Access-Control-Allow-Origin'), 'at:', new Date().toISOString());

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, Details: ${errorText}`);
                }

                const result = await response.json();
                console.log('Server response:', result);

                if (result.status === 'success') {
                    const queryParams = new URLSearchParams({
                        trackingId: result.trackingId,
                        name: result.data.name,
                        email: result.data.email,
                        phone: result.data.phone,
                        airport: result.data.airport,
                        itemType: result.data.itemType,
                        description: result.data.description,
                        dateLost: result.data.dateLost
                    }).toString();
                    console.log('Redirecting to:', '/report_submission.html?' + queryParams);
                    window.location.assign('/report_submission.html?' + queryParams);
                } else {
                    console.error('Server error:', result.message);
                    alert('Submission error: ' + result.message);
                }
            } catch (error) {
                console.error('Fetch error:', error.message);
                alert('Submission failed: ' + error.message);
            }
        });
    } catch (error) {
        console.error('Script initialization error:', error.message);
        alert('Script initialization failed: ' + error.message);
    }
</script>
</body>
</html>